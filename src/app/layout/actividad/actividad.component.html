<div [@routerTransition]>
    <div class="row col-md-12">
        <div class="col col-md-6 align-items-center custom-body-header">
            <app-bodyHeader 
                (selectionChange)="onChildSelectionChange($event)">
            </app-bodyHeader>
        </div>
        <div class="col col-md-6 text-center">
            <div class="row">
                <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
                    {{headerDataNro01}} Ejecucion Presupuestaria
                </div>
                <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
                    {{headerDataNro02}} Ejecucion Periodo
                </div>
                <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
                    {{headerDataNro03}} Actividades Pendientes
                </div>
                <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
                    {{headerDataNro04}} Actividades Retrasadas
                </div>
            </div>
        </div>
    </div>

    <!-- ======= ======= ======= EJECUCION SECTION ======= ======= ======= -->
    <div class="row mb-3 mt-4">
        <div class="col col-xl-12 col-lg-12">
            <div class="card card-body custom-card">
                <div class="row">
                    <div class="col col-md-7 col-lg-7 custom-actividad-right-sep">
                        <div class="row">
                            <div class="col col-md-12 col-lg-12">
                                <h2 class="custom-view-title">Ejecucion Financiera</h2>
                            </div>
                            <!-- ======= ======= PROYECTO SECTION ======= ======= -->
                            <div class="col col-md-3 col-lg-3">
                                <label class="custom-actividad-sub-title">Presupuesto del proyecto</label>
                                <input class="form-control" type="text" 
                                    id="presupuestoProy" name="presupuestoProy" [(ngModel)]="presupuestoProy" disabled/>
                                <label class="custom-actividad-sub-title">Ejecutado</label>
                                <input class="form-control custom-actividad-input-bg-3" type="text" 
                                    id="ejecutadoProy" name="ejecutadoProy" [(ngModel)]="ejecutadoProy" disabled/>
                            </div>
                            <div class="col col-md-3 col-lg-3">
                                <canvas id="doughnutChartProyecto"></canvas>
                            </div>
                            <!-- ======= ======= ======= ======= ======= -->
                            <!-- ======= ======= GESTION SECTION ======= ======= -->
                            <div class="col col-md-3 col-lg-3">
                                <label class="custom-actividad-sub-title">Presupuesto de la Gestion {{ gestion }}</label>
                                <input class="form-control" type="text" 
                                    id="presupuestoGest" name="presupuestoGest" [(ngModel)]="presupuestoGest" disabled/>
                                <label class="custom-actividad-sub-title">Ejecutado</label>
                                <input class="form-control custom-actividad-input-bg-3" type="text" 
                                    id="ejecutadoGest" name="ejecutadoGest" [(ngModel)]="ejecutadoGest" disabled/>
                            </div>
                            <div class="col col-md-3 col-lg-3">
                                <canvas id="doughnutChartGestion"></canvas>
                            </div>
                            <!-- ======= ======= ======= ======= ======= -->
                        </div>
                    </div>
                    <div class="col col-md-5 col-lg-5">
                        <div class="row">
                            <!-- ======= ======= DECLARACION SECTION ======= ======= -->
                            <div class="col col-md-6 col-lg-6 custom-actividad-right-sep">
                                <label class="custom-actividad-sub-title">
                                    Declaraciones de Ejecucion
                                </label>
                                <div class=" table-responsive custom-actividad-presu-avance-table">                                 
                                    <table class="table custom-table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th style="text-align: center;">ID</th>
                                                <th style="text-align: center;">Declaración</th>
                                                <th style="text-align: center;">Ejecución</th>                                            
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let presuAvance of presuAvances; let i = index">
                                                <td>
                                                    {{ presuAvance.id_proy_presu_avance }}
                                                </td>
                                                <td>
                                                    {{ ((presuAvance.fecha_hora).slice(0,10)) }}
                                                </td>
                                                <td>
                                                    {{ presuAvance.monto_avance.slice(1)}}
                                                </td>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- ======= ======= ======= ======= ======= -->
                            <!-- ======= ======= EJECUTADO SECTION ======= ======= -->
                            <div class="col col-md-6 col-lg-6">
                                <label class="custom-actividad-sub-title">Nuevo Ejecutado</label>
                                <input class="form-control" type="text" 
                                    id="montoNuevoEjecutado" name="montoNuevoEjecutado" 
                                    placeholder="Ingrese el monto ejecutado" (change)="onChangedMontoNuevoEjecutado()"
                                    [(ngModel)]="montoNuevoEjecutado"/>
                                <span class="custom-alert-message" *ngIf="!valMontoNuevoEjecutado">Debe ingresar un monto valido.</span>
                                <div></div>
                                <label class="custom-actividad-sub-title">Motivo</label>
                                <textarea class="form-control" type="text" 
                                    id="motivoNuevoEjecutado" name="motivoNuevoEjecutado" 
                                    placeholder="Ingrese el motivo de ejecucion" [(ngModel)]="motivoNuevoEjecutado">
                                </textarea>
                                <span class="custom-alert-message" *ngIf="!valMotivoNuevoEjecutado">Debe ingresar un motivo valido, con menos de 100 caracteres.</span>
                                <button type="button" class="btn btn-view-bg-1 w-100 mt-2"
                                    (click)="addPresuAvance()">
                                    <i aria-hidden="true"></i> Añadir
                                </button>
                            </div>
                            <!-- ======= ======= ======= ======= ======= -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ======= ======= ======= ======= ======= ======= ======= -->
    <!-- ======= ======= ======= GANT CHART SECTION ======= ======= ======= -->
    <div class="card mt-2">
        <div class="card-body custom-card">
            <!-- ======= ======= BUTTONS SECTION ======= ======= -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="custom-actividad-sub-title">
                    Actividades del Proyecto
                </h2>
                <div class="row">
                    <div class="col col-xl-12 col-lg-12 text-end">
                        <input class="form-check-input custom-form-actividades-checkbox" type="checkbox" 
                            id="showReprogramados" name="showReprogramados" [(ngModel)]="showReprogramados">
                        <label class="custom-form-lable-checkbox" for="showReprogramados">
                            Ver reprogramados
                        </label>
                        <button type="button" class="btn btn-view-bg-1 mx-2"
                            (click)="initAddActividad(actividad)">
                            <i aria-hidden="true"></i> Añadir
                        </button>
                        <button type="button" class="btn btn-view-bg-1"
                            (click)="initAvanceActividad(actividad)"
                            [disabled]="">
                            <i aria-hidden="true"></i> Avance
                        </button>
                    </div>
                </div>
            </div>
            <!-- ======= ======= ======= ======= ======= -->
            <!-- ======= ======= BUTTONS SECTION ======= ======= -->
            <div class="row">
                <div class="col col-md-5 col-lg-5">
                    <!-- ======= HEADER SECTION ======= -->
                    <div class="row custom-actividad-header">
                        <div class="col col-md-21 col-lg-2">
                            RES
                        </div>
                        <div class="col col-md-5 col-lg-5">
                            ACTIVIDADES
                        </div>
                        <div class="col col-md-3 col-lg-3">
                            PRESUPUESTO
                        </div>
                        <div class="col col-md-2 col-lg-2">
                            AVANCE
                        </div>
                    </div>
                    <!-- ======= ======= ======= -->
                    <!-- ======= ACTIVIDADES SECTION ======= -->
                    <div class="row">
                        <div class="col col-md-21 col-lg-2">
                            <span class="custom-vertical-text">
                                Res 1.0.1.2
                            </span>
                        </div>
                        <div class="col col-md-5 col-lg-5">
                            <div class="row">

                            </div>
                        </div>
                        <div class="col col-md-3 col-lg-3">
                            PRESUPUESTO
                        </div>
                        <div class="col col-md-2 col-lg-2">
                            AVANCE
                        </div>
                    </div>
                    <!-- ======= ======= ======= -->
                </div>
            
                <!-- Contenedor para las barras de progreso y la línea de tiempo -->
                <div class="col col-md-7 col-lg-7">
                    <div class="timeline">
                        <label class="text-center" style="background-color: #4E8646;color: #ffffff;">
                            2024
                        </label>
                        <div class="timeline-header">
                            <span class="month">Ene</span>
                            <span class="month">Feb</span>
                            <span class="month">Mar</span>
                            <span class="month">Abr</span>
                            <span class="month">May</span>
                            <span class="month">Jun</span>
                            <span class="month">Jul</span>
                            <span class="month">Ago</span>
                            <span class="month">Sep</span>
                            <span class="month">Oct</span>
                            <span class="month">Nov</span>
                            <span class="month">Dic</span>
                        </div>
                        <div class="progress-bar-container">
                            <!-- Barra de progreso de la primera tarea -->
                            <div class="progress-bar" style="width: 59%; background-color: #f7a800;"></div>
                            <!-- Barra de progreso de la segunda tarea -->
                            <div class="progress-bar" style="width: 89%; background-color: #989898;"></div>
                            <!-- Barra de progreso de la tercera tarea -->
                            <div class="progress-bar" style="width: 25%; background-color: #f7a800;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ======= ======= ======= ======= ======= ======= ======= -->
    <!-- ======= ======= ======= ACTIVIDAD MODAL ======= ======= ======= -->
    <ng-template #actividad let-modal class="custom-modal">
        <div class="modal-header">
        <h4 class="modal-title">{{ modalTitle }}</h4>
        <button type="button" class="btn-close" aria-label="Close" 
            (click)="modal.dismiss('Cross click')">
        </button>
        </div>
        
        <div class="modal-body">
        <form #actividadForm="ngForm" (ngSubmit)="onSubmit(actividadForm)">
            <div class="row">
            <div class="col col-xl-12 col-lg-12">
                <div class="card mb-3">
                <div class="card-body custom-card">
                    <div class="row">
        
                    <div class="col-md-3 ">
                        <label for="codigo">Código</label>
                        <input class="form-control" type="text" 
                            id="codigo" name="codigo" 
                            [(ngModel)]="codigo" readonly>
                    </div>

                    <div class="col-md-9 ">
                        <label for="codigo">Actividad</label>
                        <input class="form-control" type="text" 
                            id="codigo" name="codigo" 
                            [(ngModel)]="codigo" readonly>
                    </div>
                    
                    <div class="col-md-5 ">
                        <label for="codigo">Reprogramado de</label>
                        <input class="form-control" type="text" 
                            id="codigo" name="codigo" 
                            [(ngModel)]="codigo" readonly>
                    </div>
        
                    <!-- Padre y Código -->
                    <div class="col-md-3">
                        <label for="padre">Padre</label>
                        <select class="form-control" 
                                id="padre" name="padre" 
                                [(ngModel)]="padre"
                                [disabled]="tipo === 'OG'">
                        <option value="">Seleccionar padre</option>
                        <option *ngFor="let item of planifEstrategica" 
                                [value]="item.codigo"
                                [disabled]="!validarPadre(tipo, item.codigo)">
                            {{item.nombre}} ({{item.codigo}})
                        </option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label for="codigo">Actividad Resultado/Output</label>
                        <input class="form-control" type="text" 
                            id="codigo" name="codigo" 
                            [(ngModel)]="codigo" readonly>
                    </div>
        
                    <!-- Descripción -->
                    <div class="col-10">
                        <label for="descripcion">Descripción</label>
                        <textarea class="form-control" 
                                id="descripcion" name="descripcion" 
                                [(ngModel)]="descripcion" rows="3" required></textarea>
                    </div>
                    <div class="col-2">
                        <label for="codigo">Presupuesto</label>
                        <input class="form-control" type="text" 
                            id="codigo" name="codigo" 
                            [(ngModel)]="codigo" readonly>
                    </div>

                    <div class="planificacion">
                        <label for="fechaIdentificacion" class="titulo">Planificación</label>
                        
                        <div class="tabla-meses">
                            <!-- Encabezado del año -->
                            <div class="fila-encabezado">
                            <span class="celda-anio" colspan="12">2024</span>
                            </div>
                            
                            <!-- Meses -->
                            <div class="fila-meses">
                            <span *ngFor="let mes of meses" class="mes">{{ mes }}</span>
                            </div>
                            
                            <!-- Checkboxes -->
                            <div class="fila-checkboxes">
                            <span *ngFor="let dia of dias" class="checkbox-container">como
                                <input 
                                type="checkbox" 
                                [id]="'checkbox-' + dia" 
                                [value]="dia"
                                (change)="toggleCheckbox(dia)"
                                [checked]="seleccionados.includes(dia)" 
                                />
                                <label [for]="'checkbox-' + dia">asdsadas</label>
                            </span>
                            </div>
                        </div>
                        </div>
                        

                    
                    <div class="custom-form-separator mx-auto my-3" style="border-color: #4E8646;"> </div>
                    
                    <div class="col-6 mb-3">
                        <!-- Título con línea blanca -->
                            <div class="relative mb-1">
                                <div class="row">
                                    <span class="text-green-700 relative z-10 pl-2">Avance</span>
                                    <div class="col col-xl-4 col-lg-4 mt-auto">
                                        <label for="codigo">% Avance</label>
                                        <input class="form-control" type="text" 
                                            id="codigo" name="codigo" 
                                            [(ngModel)]="codigo" readonly>
                                    </div>
                                    <div class="col col-xl-6 col-lg-6 mt-auto">
                                        <label for="codigo">Nuevo Ejecutado</label>
                                        <input class="form-control" type="text" 
                                            id="codigo" name="codigo" 
                                            [(ngModel)]="codigo" readonly>
                                    </div>
                                    <div class="col col-xl-1 col-lg-1 mt-auto">
                                    <button type="submit" class="btn btn-bg-1">
                                        <i aria-hidden="true"></i> +
                                    </button>
                                    </div>
                                </div>
                                
                                <span class="text-green-700 relative z-10 pl-2 mt-4">Ejecucion Presupuestaria</span>
                                    <!-- Contenedor blanco para la tabla -->
                                        <table class="w-full border-collapse table-bordered mt-2">
                                            <thead>
                                                <tr class="bg-yellow-300 ">
                                                    <th class="col-3 py-0.5 px-2 text-left text-sm font-bold">Declaracion</th>
                                                    <th class="col-3 py-0.5 px-2 text-left text-sm font-bold">Avance</th>
                                                    <th class="col-3 py-0.5 px-2 text-left text-sm font-bold">Ejecucion</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let row of evaluationData">
                                                    <td class="py-0.5 px-2 text-sm">{{ row.Declaracion }}</td>
                                                    <td class="py-0.5 px-2 text-sm">{{ row.Avance }}</td>
                                                    <td class="py-0.5 px-2 text-sm">{{ row.Ejecucion }}</td> 
                                                </tr>
                                            </tbody>
                                        </table>
                                </div>
                            </div>
                        <!-- Línea vertical -->
                        <div class="col-auto mt-4">
                            <div style="width: 1px; height: 100%; background-color: #4E8646;"></div>
                        </div>  

                        <div class="col col-xl-5 col-lg-5 mt-auto top-0">
                            <label for="codigo">Factores que impidieron el cumplimiento</label>
                            <input class="form-control" type="text" 
                                id="codigo" name="codigo" 
                                [(ngModel)]="codigo" readonly>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="d-flex justify-content-center" style="width: 100%;">
                            <button type="button" class="btn btn-bg-3" (click)="modal.close('Cerrar')">
                            <i class="fa fa-times" aria-hidden="true"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-bg-3" style="background-color: #ff9131;" (click)="modal.close('Cerrar')">
                            <i aria-hidden="true"></i> Reprogramar
                            </button>
                            <button type="submit" class="btn btn-bg-1">
                            <i class="fa fa-floppy-o" aria-hidden="true"></i> Guardar
                            </button>
                        </div>
                        </div>
                </div>
                </div>
            </div>
            </div>
        </form>
        </div>
    </ng-template>
</div>