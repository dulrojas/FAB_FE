<div [@routerTransition]>
  <!-- Sección del Encabezado -->
  <div class="row col-md-12">
    <!-- Bloque de Encabezado -->
    <div class="col col-md-6 align-items-center custom-body-header">
      <!-- Componente personalizado para el encabezado -->
      <app-bodyHeader (selectionChange)="onChildSelectionChange($event)"> </app-bodyHeader>
    </div>
    <!-- Bloque de Tarjetas de Estadísticas -->
    <div class="col col-md-6 text-center">
      <!-- Fila para organizar las tarjetas -->
      <div class="row">
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{ headerDataNro01 }} Indicadores
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{ headerDataNro02 }} Meta Periodo Cumplida
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{ headerDataNro03 }} Sin Avance
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{ headerDataNro04 }} Meta Final Cumplida
        </div>
      </div>
    </div>
  </div>
  <!-- ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= -->
  <!-- Sección de botones para Reportar Indicador -->
  <div class="card mt-3 mt-2">
    <div class="card-body custom-card table-responsive">
      <!-- TITULO DE LA TABLA Y BOTON DE REPORTAR -->
      <div class="d-flex justify-content-between align-items-center">
        <!-- Titulo de la Tabla -->
        <h2 class="title" style="color: #4e8646">Ejecución Estratégica</h2>
        <!-- Botones Reportar -->
        <div class="row">
          <div class="col col-xl-12 col-lg-12 text-end">
            <button type="button" class="btn btn-view-bg-1" (click)="initEditEjecEstrategica(ejecEstrategicaFormModal)"
              [disabled]="!ejecEstrategicaSelected">
              <i aria-hidden="true"></i> Reportar
            </button>
          </div>
        </div>
      </div>
      <!-- ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= -->
      <!-- TABLA EJECUCION ESTRATEGICA -->
      <div class="row">
        <div class="container mt-2">
          <table class="table custom-table table-striped table-bordered">
            <thead>
              <tr>
                <th></th>
                <th colspan="2" style="text-align: center"></th>
                <th colspan="6" style="background-color: #699762; text-align: center">
                  PERIODO VIGENTE
                </th>
                <th colspan="3" style="text-align: center">META FINAL</th>
              </tr>
              <tr>
                <th></th>
                <th>Cod</th>
                <th>Nombre</th>
                <th style="background-color: #699762; text-align: center">Reporte a</th>
                <th style="background-color: #88a117; text-align: center">Progreso</th>
                <th style="background-color: #699762; text-align: center">Medida</th>
                <th style="background-color: #88a117; text-align: center">Notas</th>
                <th style="background-color: #699762; text-align: center">MetaPer</th>
                <th style="background-color: #699762; text-align: center">Avance Per.</th>
                <th>Meta Final</th>
                <th>Avance</th>
                <th>Descripcion</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let ejecEstrategica of ejecEstrategicaTable; let i = index">
                <td>
                  <input type="checkbox" [(ngModel)]="ejecEstrategica.selected"
                    (change)="checkboxChanged(ejecEstrategica)" id="checkbox-{{ i }}" name="checkbox-{{ i }}" />
                </td>
                <!-- CODIGO -->
                <td>{{ ejecEstrategica.codigo }}</td>
                <!-- NOMBRE DEL INDICADOR -->
                <td>{{ ejecEstrategica.indicador }}</td>
                <!-- FECHA A REPORTAR -->                
                <td>{{this.indicadoresAvance[i]?.fecha_reportar || '-'}}</td>
                <!-- PROGRESO SE CONECTA A VALOR REPORTADO-->
                <td>{{ this.indicadoresAvance[i]?.valor_reportado || '-' }}</td>
                <!-- MEDIDA -->
                <td>{{ ejecEstrategica.medida }}</td>
                <!-- NOTAS SE CONECTA A COMENTARIOS DE IND.AVANCE -->
                <td>{{ this.indicadoresAvance[i]?.comentarios || '-' }}</td>
                <!-- META PER SE CONECTA A VALOR ESPERADO -->
                <td>{{ this.indicadoresAvance[i]?.valor_esperado || '-' }}</td>
                <!-- “Avance Per.”, pone un gráfico equivalente a un avance porcentual entre la “Meta Per” que es el “valor_esperado” de anterior pantalla y “Progreso” (valor_reportado). -->
                <td>
                  <div class="progress-container">
                    <div class="progress-text">{{ calculateAvancePer(ejecEstrategica) }}%</div>
                    <div class="progress-bar per" 
                         [style.width]="calculateAvancePer(ejecEstrategica) + '%'">
                    </div>
                  </div>
                </td>
                <!-- META FINAL -->
                <td>{{ ejecEstrategica.meta_final }}</td>

                <!-- “Avance”, pone un gráfico equivalente a un avance porcentual entre “valor_reportado” y “meta_final”. -->
                <td>
                  <div class="progress-container">
                    <div class="progress-text">{{ calculateAvanceTotal(ejecEstrategica) }}%</div>
                    <div class="progress-bar total" 
                         [style.width]="calculateAvanceTotal(ejecEstrategica) + '%'">
                    </div>
                  </div>
                </td>
                <!-- DESCRIPCION -->
                <td>{{ ejecEstrategica.descripcion }}</td>
              </tr>
            </tbody>
          </table>
          <div class="d-flex justify-content-center">
            <ngb-pagination [(page)]="mainPage" [pageSize]="mainPageSize" [collectionSize]="totalLength" [maxSize]="3"
              [rotate]="true" [boundaryLinks]="true">
            </ngb-pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= ======= -->
<ng-template #ejecEstrategicaFormModal let-modal class="custom-modal">
  <div class="modal-header">
    <h4 class="modal-title">Indicador</h4>
  </div>
  <div class="modal-body">
    <form #ejecEstrategicaForm="ngForm" (ngSubmit)="onSubmit(ejecEstrategicaForm)">
      <div class="row">
        <div class="col col-xl-12 col-lg-12">
          <div class="card">
            <div class="card-body custom-card">
              <div class="row">
                <!-- ======= ======= TIPO - SUBTIPO - CODIGO ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-auto">
                  <!-- ======= ======= TIPO ======= ======= -->
                  <div class="col col-xl-3 col-lg-3">
                    <label for="id_proy_elem_padre">Tipo</label>
                    <input class="form-control" type="text" id="id_proy_elem_padre" name="id_proy_elem_padre"
                      [disabled]="!editMode" [value]="getElementoNombre(id_proy_elem_padre)" disabled />
                  </div>
                  <!-- ======= ======= COMPONENTE SECTION ======= ======= -->
                  <div class="col col-xl-1 col-lg-1 mt-auto">
                    <div class="col col-xl-1 col-lg-1 mt-auto">
                      <label class="btn-view-bg-3" [ngStyle]="{ 'background-color': '#' + color }">{{ sigla }}</label>
                    </div>
                  </div>
                  <!-- ======= ======= Espacio ======= ======= -->
                  <div class="col col-xl-6 col-lg-6"></div>
                  <!-- ======= ======= CODIGO ======= ======= -->
                  <div class="col col-xl-2 col-lg-2">
                    <label for="codigo">Código</label>
                    <input class="form-control" type="text" id="codigo" name="codigo" [(ngModel)]="codigo"
                      [disabled]="!editMode" [readonly]="true" required />
                  </div>
                </div>
                <!-- ======= ======= CATEGORIA - SUBCATEGORIA - TIPO ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-2">
                  <!-- ======= ======= CATEGORIA ======= ======= -->
                  <!-- CATEGORÍA -->
                  <div class="col col-xl-4 col-lg-4 mt-auto">
                    <label for="inst_categoria_1">Categoría</label>
                    <select class="form-control" id="inst_categoria_1" name="inst_categoria_1" [disabled]="!editMode">
                      <option *ngFor="let categoria of ejecCategoria" [value]="categoria.id_inst_categoria">
                        {{ categoria.inst_categoria_1 }}
                      </option>
                    </select>
                  </div>

                  <!-- SUBCATEGORÍA -->
                  <div class="col col-xl-4 col-lg-4 mt-auto">
                    <label for="inst_categoria_2">SubCategoría</label>
                    <select class="form-control" id="inst_categoria_2" name="inst_categoria_2"
                      [(ngModel)]="inst_categoria_2" [disabled]="!editMode" aria-label="Seleccionar SubCategoría">
                      <option *ngFor="let categoria of ejecSubCategoria" [value]="categoria.id_inst_categoria">
                        {{ categoria.nombre }}
                      </option>
                    </select>
                  </div>

                  <!-- TIPO -->
                  <div class="col col-xl-4 col-lg-4 mt-auto">
                    <label for="tipoIndicador">Tipo</label>
                    <select class="form-control" id="inst_categoria_3" name="inst_categoria_3"
                      [(ngModel)]="inst_categoria_3" [disabled]="!editMode" aria-label="Seleccionar Tipo">
                      <option *ngFor="let categoria of ejecTipoCategoria" [value]="categoria.id_inst_categoria">
                        {{ categoria.nombre }}
                      </option>
                    </select>
                  </div>
                </div>
                <!-- ======= ======= NOMBRE-"INDICADOR" - DESCRIPCION ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-2">
                  <!-- INDICADOR -->
                  <div class="col col-xl-12 col-lg-12 mt-auto">
                    <label for="indicador">Indicador</label>
                    <input class="form-control" type="text" id="indicador" name="indicador" [(ngModel)]="indicador"
                      [disabled]="!editMode" />
                  </div>
                  <!-- DESCRIPCION -->
                  <div class="col col-xl-12 col-lg-12 mt-auto">
                    <label for="descripcion">Descripcion</label>
                    <input class="form-control" type="text" id="descripcion" name="descripcion"
                      [(ngModel)]="descripcion" [disabled]="!editMode" />
                  </div>
                </div>
                <!-- ======= ======= PROY ELEMENTOS ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-2">
                  Padre
                  <!-- Padre -->
                  <div class="col-12 mt-2 mb-2 p-2" style="border: 1px solid white">
                    <div class="row">
                      <!-- Código -->
                      <div class="col col-xl-2 col-lg-2">
                        <label for="codigo">Código</label>
                        <input class="form-control" type="text" id="codigo" name="codigo" [(ngModel)]="codigo"
                          [disabled]="!editMode" [readonly]="true" required />
                      </div>
                      <!-- Tipo -->
                      <div class="col col-xl-2 col-lg-2">
                        <label for="tipoIndicador">Tipo</label>
                        <input type="text" class="form-control" id="id_proy_elem_padre" [disabled]="!editMode"
                          [value]="getElementoNombre(id_proy_elem_padre)" readonly />
                      </div>
                      <!-- Componente -->
                      <div class="col col-xl-1 col-lg-1 mt-auto">
                        <div class="col col-xl-1 col-lg-1 mt-auto">
                          <label class="btn-view-bg-3" [ngStyle]="{ 'background-color': '#' + color }">{{ sigla
                            }}</label>
                        </div>
                      </div>
                      <!-- Abuelo -->
                      <div class="col col-xl-3 col-lg-3">
                        <label for="abuelo">Abuelo</label>
                        <select class="form-control" [(ngModel)]="idp_categoria" name="idp_categoria">
                          <select class="form-control" id="padre" name="padre" [(ngModel)]="selectedParentCodigo"
                            [disabled]="tipo === 'OG'" (change)="onParentChange()">
                            <option value="">Seleccionar padre</option>
                            <option *ngFor="let parent of validParents" [value]="parent.codigo">
                              {{ parent.nombre }} ({{ parent.codigo }})
                            </option>
                          </select>
                        </select>
                      </div>
                      <!-- Descripción -->
                      <div class="col col-xl-12 col-lg-12">
                        <label for="descripcion">Descripción</label>
                        <input class="form-control" type="text" id="descripcion" name="descripcion"
                          [(ngModel)]="descripcion" [disabled]="!editMode" />
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ======= ======= LINEA BASE - MEDIDA - META FINAL - MEDIO VERIFICA ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-2">
                  <!-- Linea base -->
                  <div class="col col-xl-2 col-lg-2">
                    <label for="linea_base">Línea base</label>
                    <input class="form-control" type="text" id="linea_base" name="linea_base" [(ngModel)]="linea_base"
                      [disabled]="!editMode" />
                  </div>
                  <!-- Medida -->
                  <div class="col col-xl-2 col-lg-2">
                    <label for="medida">Medida</label>
                    <input class="form-control" type="text" id="medida" name="medida" [(ngModel)]="medida"
                      [disabled]="!editMode" />
                  </div>
                  <!-- Meta Final -->
                  <div class="col col-xl-2 col-lg-2">
                    <label for="meta_final">Meta Final</label>
                    <input class="form-control" type="text" id="meta_final" name="meta_final" [(ngModel)]="meta_final"
                      [disabled]="!editMode" />
                  </div>
                  <!-- Medio de verificación -->
                  <div class="col col-xl-6 col-lg-6">
                    <label for="medio_verifica">Medio de verificación</label>
                    <input class="form-control" type="text" id="medio_verifica" name="medio_verifica"
                      [(ngModel)]="medio_verifica" [disabled]="!editMode" />
                  </div>
                  <!-- Supuestos/Comentario -->
                  <div class="col col-xl-12 col-lg-12">
                    <label for="comentario">Supuestos/Comentario</label>
                    <input class="form-control" type="text" id="comentario" name="comentario" [(ngModel)]="comentario"
                      [disabled]="!editMode" />
                  </div>
                </div>
                <!-- ======= ======= REPORTE ======= ======= -->
                <div class="row col col-xl-12 col-lg-12 mt-2">
                  <div class="col-12 mt-2 mb-2 p-2" style="border: 1px solid white">
                    <label for="comentario">Reporte</label>
           
                    <!-- Tabla Reporte -->
                    <table class="table custom-table-planifEstrategica table-striped table-bordered table-responsive">
                      <thead>
                        <tr>
                          <th style="text-align: center">#</th>
                          <th style="text-align: center">Periodo</th>
                          <th style="text-align: end">Valor Esperado</th>
                          <th style="text-align: center">Progreso</th>
                          <th style="text-align: center">Notas</th>
                          <th style="text-align: center">Evidencia</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of indicadoresAvance; let i = index">
                          <!-- Índice -->
                          <td style="text-align: center">{{ i + 1 }}</td>

                          <!-- Periodo   this.indicadoresAvance[] -->
                          <td style="text-align: center">
                            {{ this.indicadoresAvance[i]?.fecha_hora_reporte }}
                          </td>

                          <!-- Valor esperado -->
                          <td style="text-align: center">
                            {{
                            convertToNumber(this.indicadoresAvance[i]?.valor_esperado)
                            | number : '1.0-0'
                            }}
                          </td>

                          <!-- Progreso con barra de progreso -->
                          <td style="text-align: center">
                            <div class="progress" style="height: 20px; width: 100%">
                              <div class="progress-bar bg-success" role="progressbar" 
                              [style.width.%]="convertToNumber(this.indicadoresAvance[i]?.valor_esperado)" 
                              [attr.aria-valuenow]="convertToNumber(this.indicadoresAvance[i]?.valor_reportado )" 
                              aria-valuemin="0" aria-valuemax="100">
                              </div>
                            </div>
                            <span>{{ this.indicadoresAvance[i]?.valor_reportado }}%</span>
                          </td>

                          <!-- Notas -->
                          <td style="text-align: center">
                            {{ this.indicadoresAvance[i]?.comentarios || '-' }}
                          </td>

                          <!-- Evidencia -->
                          <td style="text-align: center">
                            <a *ngIf="item.ruta_evidencia" [href]="this.indicadoresAvance[i]?.ruta_evidencia"
                              target="_blank">{{ this.indicadoresAvance[i]?.ruta_evidencia }}</a>
                            <span *ngIf="!item.ruta_evidencia">Sin evidencia</span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="modal-footer">
                    <div class="d-flex justify-content-end" style="width: 100%">
                      <!-- ======= ======= BUTTONS SECTION ======= ======= -->
                      <button type="button" class="btn btn-bg-3" (click)="modal.close('Cerrar')">
                        <i class="fa fa-times" aria-hidden="true"></i> Cancelar
                      </button>
                      <button type="button" class="btn btn-bg-1" [disabled]="ejecEstrategicaForm.invalid"
                        (click)="onSubmit(); modal.close('Añadir')">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i> Grabar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>               
  </div>
</ng-template>

          
<!-- ======= ======= ======= ======= ======= ======= ======= -->