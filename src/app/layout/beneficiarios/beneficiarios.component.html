<div [@routerTransition]>
  <!-- Encabezado -->
  <div class="row col-md-12">   
    <div class="col col-md-6 align-items-center custom-body-header">
      <app-bodyHeader></app-bodyHeader>
    </div>
  
    <!-- Tarjetas de Estadísticas -->
    <div class="col col-md-6 text-center">
      <div class="row">
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{headerDataNro01}} Comunidades / Organizaciones
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{headerDataNro02}} Mujeres beneficiadas
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{headerDataNro03}} Hombres beneficiados
        </div>
        <div class="col col-md-2 m-1 d-flex justify-content-center align-items-center custom-info-cards flex-grow-1">
          {{headerDataNro04}} Aliados
        </div>
      </div>
    </div>
  </div>

<!-- Tabla de Beneficiarios Alcanzados -->
<div class="card mb-3" style="margin-top: 20px;">
<div class="card-body custom-card table-responsive">
  <!-- Encabezado y Botones -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="title" style="color: #4E8646;">Beneficiarias/os Alcanzados</h2>
      <!-- Botones de Acción -->
      <div class="row">
        <div class="d-flex col col-xl-12 col-lg-12 text-end">
          <button type="button" class="btn btn-view-bg-1"
            (click)="openModal(beneficiariesModal)">
            <i class="fa fa-plus" aria-hidden="true"></i> Añadir
          </button>
          <button type="button" class="btn btn-view-bg-1"
            [disabled]="!selectedBeneficiarios"
            (click)="openModal(beneficiariesModal, selectedBeneficiarios)">
            <i class="fa fa-pencil" aria-hidden="true"></i> Editar
          </button>
          <button type="button" class="btn btn-view-bg-1" 
            [disabled]="!selectedBeneficiarios" 
            (click)="onDelete()">
            <i class="fa fa-trash" aria-hidden="true"></i> Eliminar
          </button>
        </div>
      </div>  
    </div>
    <!-- Tabla de Beneficiarios -->
    <table class="table custom-table table-striped table-bordered">
        <thead>
            <tr>
              <th></th>
              <th>ID</th>
              <th>Fecha</th>
              <th>Municipio</th>
              <th>Comunidad</th>
              <th>Tipo de Organización</th>
              <th>Organización</th>
              <th>Actividad</th>
              <th>Evento</th>
              <th>Mujeres</th>
              <th>Hombres</th>
              <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let beneficiario of paginatedBeneficiarios">
              <td>
                <input
                  type="checkbox"
                  [(ngModel)]="beneficiario.selected"
                  (change)="checkboxChanged(beneficiario)"
                  id="checkbox-{{ i }}"
                />
              </td>
              <td>{{ beneficiario.id }}</td>
              <td>{{ beneficiario.fecha }}</td>
              <td>{{ beneficiario.municipio }}</td>
              <td>{{ beneficiario.comunidad }}</td>
              <td>{{ beneficiario.tipoOrganizacion }}</td>
              <td>{{ beneficiario.organizacion }}</td>
              <td>{{ beneficiario.actividad }}</td>
              <td>{{ beneficiario.evento }}</td>
              <td>{{ beneficiario.mujeres }}</td>
              <td>{{ beneficiario.hombres }}</td>
              <td>{{ beneficiario.total }}</td>
            </tr>
        </tbody>
    </table>
    <!-- Botones de tabla -->
    <div class="d-flex justify-content-center">
      <ngb-pagination 
      [(page)]="mainPage" 
      [pageSize]="mainPageSize" 
      [collectionSize]="totalLength"
      [maxSize]="3"
      [rotate]="true"
      [boundaryLinks]="true">
      </ngb-pagination>
    </div>      
  </div>
</div>

<ng-template #beneficiariesModal let-modal class="custom-modal">
<!-- Encabezado del Modal-->
<div class="modal-header">
<h4 class="modal-title">{{ selectedBeneficiarios ? 'Editar' : 'Añadir' }} Beneficiarios Alcanzados</h4>
<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
</div>
<!-- Cuerpo del Modal -->
<div class="modal-body">
<form [formGroup]="beneficiariesForm" (ngSubmit)="onSubmit()">
  <div class="row">
    <div class="col col-xl-12 col-lg-12">
      <div class="card mb-3">
        <div class="card-body custom-card">
          <!-- ID y Fecha -->
          <div class="row">
            <div class="col col-xl-2 col-lg-2 mt-auto">
              <label for="id">Id</label>
              <input class="form-control" type="text" 
                  id="id" name="id" [(ngModel)]="id" disabled formControlName="id" class="form-control"/>
            </div>
            <div class="col col-xl-6 col-lg-6 mt-auto">
            </div>
            <div class="col col-xl-4 col-lg-4 mt-auto">
              <label for="fecha">Fecha de evento</label>
              <input type="date" formControlName="fecha" class="form-control" />
            </div>
          </div>
               
          <div class="row">
          <!-- Actividad y Evento -->
          <div class="col col-xl-6 col-lg-6 mt-auto">
              <label for="actividad">Pertenece a la Actividad</label>
              <select formControlName="actividad" class="form-control">
                <option *ngFor="let actividad of actividades" [value]="actividad.id_proy_actividad">
                  {{ actividad.actividad }}
                </option>
              </select>
          </div>
          <div class="col col-xl-6 col-lg-6 mt-auto">
              <label for="evento">Evento</label>
              <input type="text" formControlName="evento" class="form-control" />
          </div>
          <!-- Departamento, Municipio, Comunidad -->
          <div class="col col-xl-3 col-lg-3 mt-auto">
            <label for="department">Departamento</label>
            <select formControlName="department" class="form-control" (change)="onDepartamentoChange($event.target.value)">
              <option value="" disabled selected>Seleccione un departamento</option>
              <option *ngFor="let depto of departamentos" [value]="depto.orden">
                {{ depto.nombre }}
              </option>
            </select>
          </div>
          <div class="col col-xl-4 col-lg-4 mt-auto">
            <label for="municipio">Municipio</label>
            <select formControlName="municipio" class="form-control" (change)="onMunicipioChange($event.target.value)">
              <option *ngFor="let muni of municipios" [value]="muni.orden">
                {{ muni.nombre }}
              </option>
            </select>
          </div>
          <div class="col col-xl-3 col-lg-3 mt-auto">
            <label for="comunidad">Comunidad</label>
            <select formControlName="comunidad" class="form-control" >
              <option *ngFor="let comunidad of comunidades" [value]="comunidad.orden">
                {{ comunidad.nombre }}
              </option>
            </select>
          </div>
          <div class="col col-xl-2 col-lg-2 mt-auto" style=" font-size: 1.5em; font-weight: bold;">
            <div class="d-flex justify-content-center" style="width: 100%;">
              <button type="button" class="btn btn-bg-3" (click)="openModal(listaBeneficiariesModal)">
                <i class="" aria-hidden="true"></i> +
            </button>
            </div> 
          </div>
           <!-- Tipo de Organización y Organización -->
           <div class="col col-xl-6 col-lg-6 mt-auto">
            <label for="tipoOrganizacion">Tipo de Organización</label>
            <select formControlName="tipoOrganizacion" class="form-control">
              <option value="" disabled selected>Seleccione un tipo de organización</option>
              <option *ngFor="let tipo of organizacionTipo" [value]="tipo.id_subtipo">
                {{ tipo.descripcion_subtipo }}
              </option>
            </select>
          </div>
          <div class="col col-xl-6 col-lg-6 mt-auto">
            <label for="organizacion">Nombre de la Organización</label>
            <input type="text" formControlName="organizacion" class="form-control" />
          </div>
          <!-- Detalle -->
          <div class="col col-xl-12 col-lg-12 mt-auto">
            <label for="details">Detalle de evento</label>
            <textarea formControlName="details" class="form-control"></textarea>
          </div>
          <!-- Mujeres, Hombres y Total -->
          <div class="col col-xl-3 col-lg-3 mt-auto">
            <label for="mujeres">Nro de Mujeres</label>
            <input type="number" formControlName="mujeres" class="form-control" />
          </div>
          <div class="col col-xl-3 col-lg-3 mt-auto">
            <label for="hombres">Nro de Hombres</label>
            <input type="number" formControlName="hombres" class="form-control" />
          </div>
          <div class="col col-xl-3 col-lg-3 mt-auto">
            <label for="total">Total</label>
            <input type="number" formControlName="total" class="form-control" />
          </div>
          <div class="col col-xl-3 col-lg-3 mt-auto" style=" font-size: 1.5em; font-weight: bold;">
            <div class="d-flex justify-content-center" style="width: 100%;">
              <button type="button" class="btn btn-bg-3" (click)="openModal(listaBeneficiariesModal)">
                <i class="" aria-hidden="true"></i> Lista
            </button>
            </div> 
          </div>

          <!-- Persona Registro -->
          <div class="col col-xl-6 col-lg-6 mt-auto">
            <label for="registeredBy">Persona Registro</label>
            <input type="text" formControlName="registeredBy" class="form-control" />
          </div>
        </div>

          <!-- Botones Cancelar y Guardar -->
          <div class="modal-footer mt-3">
            <div class="d-flex justify-content-center" style="width: 100%;">
              <button type="button" class="btn btn-bg-3" (click)="modal.close('Cerrar')">
                <i class="fa fa-times" aria-hidden="true"></i> Cancelar
            </button>
            <button type="button" class="btn btn-bg-1" (click)="onSubmit(); modal.close('Añadir')">
              <i class="fa fa-floppy-o" aria-hidden="true"></i> Grabar
            </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
</div>
</ng-template>

<ng-template #listaBeneficiariesModal let-modal class="custom-modal">
  <!-- Encabezado del Modal-->
  <div class="modal-header">
    <h4 class="modal-title">Lista de Beneficiarios</h4>  
  <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <!-- Cuerpo del Modal -->
  <div class="modal-body">
  <form [formGroup]="beneficiariesForm" (ngSubmit)="onSubmit()">
    <div class="row">
      <div class="col col-xl-12 col-lg-12">
        <div class="card mb-3">
          <div class="card-body custom-card table-responsive ">
            <table class="table custom-table table-striped table-bordered ">
              <thead>
                  <tr>
                    <th>#</th>
                    <th>Comunidad</th>
                    <th>Doc.Iden.</th>
                    <th>Nombre</th>
                    <th>Rango edad</th>
                    <th>Sexo</th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let beneficiario of paginatedBeneficiarios">
                    <td>{{ beneficiario.id }}</td>
                    <td>{{ beneficiario.comunidad }}</td>
                    <td>{{ beneficiario.docIden }}</td>
                    <td>{{ beneficiario.nombre }}</td>
                    <td>{{ beneficiario.rangoEdad }}</td>
                    <td>{{ beneficiario.sexo }}</td>
                  </tr>
              </tbody>
          </table>
            <!-- Botones Cancelar y Guardar -->
            <div class="modal-footer mt-3">
              <div class="d-flex justify-content-center" style="width: 100%;">
                <button type="button" class="btn btn-bg-3" (click)="modal.close('Cerrar')">
                  <i class="fa fa-floppy-o" aria-hidden="true"></i> ok
              </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  </div>
  </ng-template>


<!-- ///////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<!-- Tabla Aliados -->
<div class="card mb-3" style="margin-top: 20px;">
<div class="card-body custom-card table-responsive">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="title" style="color: #4E8646; font-size: 180%;">Aliados</h2>
  <div class="row">
    <div class="d-flex col text-end">
      <button type="button" class="btn btn-view-bg-1" (click)="openAliadoModal(aliadosModal)">
        <i class="fa fa-plus"></i> Añadir
      </button>
      <button
        type="button"
        class="btn btn-view-bg-1 ms-2"
        (click)="openAliadoModal(aliadosModal, selectedAliados)"
        [disabled]="!selectedAliados">
        <i class="fa fa-pencil"></i> Editar
      </button>
      <button type="button" class="btn btn-view-bg-1 ms-2" [disabled]="!selectedAliados" (click)="onDeleteAliado()">
        <i class="fa fa-trash"></i> Eliminar
      </button>
      
    </div>
  </div>
</div>

<div class="row">
  <div class="container mt-4">
    <table class="table custom-table table-striped">
      <thead>
        <tr>
          <th></th>
          <th>ID</th>
          <th>Fecha</th>
          <th>Institución / Organización</th>
          <th>Nombre del Referente</th>
          <th>Vínculo con los Resultados</th>
          <th>Convenio</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let aliado of paginatedAliados">
          <td>
            <input
              type="checkbox"
              [(ngModel)]="aliado.selected"
              (change)="checkboxChangedAliado(aliado)"
              id="checkbox-{{ i }}"
            />
          </td>
          <td>{{ aliado.id }}</td>
          <td>{{ aliado.fecha }}</td>
          <td>{{ aliado.institucion }}</td>
          <td>{{ aliado.referente }}</td>
          <td>{{ aliado.vinculo }}</td>
          <td>{{ aliado.convenio }}</td>
        </tr>
      </tbody>
    </table>
    <div class="d-flex justify-content-center">
    </div>
  </div>
</div>
</div>
</div>

<!-- Modal for Adding/Editing Aliados -->
<ng-template #aliadosModal let-modal class="custom-modal">
<div class="modal-header">
<h4 class="modal-title">{{ selectedAliados ? 'Editar' : 'Añadir' }} Aliado</h4>
<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
</div>

<div class="modal-body">
<form *ngIf="aliadosForm" [formGroup]="aliadosForm" (ngSubmit)="onSubmitAliadosForm()">
  <div class="card mb-3">
    <div class="card-body custom-card">
      <div class="row">
        <div class="col col-xl-2 col-lg-2 mt-auto">
          <label for="id">ID</label>
          <input type="text" formControlName="id" class="form-control" readonly />
        </div>
        <div class="col col-xl-5 col-lg-5 mt-auto">
        </div>
        <div class="col col-xl-5 col-lg-5 mt-auto">
          <label for="identificationDate">Fecha de identificación</label>
          <input type="date" formControlName="identificationDate" class="form-control" />
        </div>
      </div>

      <div class="row mt-3">
        <div class="col col-xl-5 col-lg-5 mt-auto">
          <label for="tipoOrganizacion">Institucion/Organizacion</label>
          <select formControlName="tipoOrganizacion" class="form-control">
            <option value="" disabled selected>Seleccione un tipo de organización</option>
            <option *ngFor="let tipo of organizacionTipo" [value]="tipo.id_subtipo">
              {{ tipo.descripcion_subtipo }}
            </option>
          </select>
        </div>
        <div class="col col-xl-2 col-lg-2 mt-auto" style=" font-size: 1.5em; font-weight: bold;">
          <div class="d-flex justify-content-center" style="width: 100%;">
            <button type="button" class="btn btn-bg-3" (click)="openModal(listaBeneficiariesModal)">
              <i class="" aria-hidden="true"></i> +
          </button>
          </div> 
        </div>
        <div class="col col-xl-5 col-lg-5 mt-auto">
          <label for="referentName">Nombre Referente</label>
          <input type="text" formControlName="referentName" class="form-control" />
        </div>

        <div class="col col-xl-12 col-lg-12 mt-auto">
          <label for="resultsLink">Vínculo con Resultados</label>
          <textarea formControlName="resultsLink" class="form-control"></textarea>
        </div>

        <div class="col-md-6">
          <label for="convenio">Convenio</label>
          <select formControlName="convenio" class="form-control">
            <option value="" disabled selected>Seleccione un convenio</option>
            <option *ngFor="let convenio of tiposConvenio" [value]="convenio.id">
              {{ convenio.descripcion }}
            </option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="registeredBy">Persona Registro</label>
          <input type="text" formControlName="registeredBy" class="form-control" />
        </div>

        <div class="modal-footer">
        <div class="d-flex justify-content-center" style="width: 100%;">
            <button type="button" class="btn btn-bg-3" (click)="modal.close('Cerrar')">
              <i class="fa fa-times"></i> Cancelar
            </button>
            <button type="submit" class="btn btn-bg-1">
              <i class="fa fa-floppy-o"></i> Grabar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
</div>
</ng-template>


</div>
